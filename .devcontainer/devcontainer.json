{
  "name": "nerfstudio-colmap",
  // "image": "ghcr.io/nerfstudio-project/nerfstudio:latest",
  "build": {
    "dockerfile": "Dockerfile",
    "context": ".."          // build context = repo root
  },

  // Mount your project into /workspace
  "workspaceMount": "source=${localWorkspaceFolder},target=/workspace,type=bind",
  "workspaceFolder": "/workspace",
  "mounts": [
    "source=/home/dbl@grazper.net/david-thesis/data,target=/workspace/data,type=bind"
  ],

  // GPU + larger shared memory
  // "runArgs": ["--gpus", "all", "--shm-size=12gb", "--ipc=host"],
  "runArgs": [
    "--gpus", "all",
    "--shm-size=12gb",
    "-e", "DISPLAY=${env:DISPLAY}",
    "-e", "QT_X11_NO_MITSHM=1",
    "-v", "/tmp/.X11-unix:/tmp/.X11-unix:rw",
    "--device=/dev/dri"
  ],

  // Optional viewer port
  "forwardPorts": [7007],

  // Install VS Code extensions in the container automatically
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",          // Python (includes debugger)
        "ms-python.vscode-pylance",  // Language server
        "ms-toolsai.jupyter",        // Notebooks (optional)
        "ms-azuretools.vscode-docker"// Docker ext (optional)
      ],
      "settings": {
        // Chooses which python to use (I use usr/bin/python when in dev container)
        "python.defaultInterpreterPath": "/usr/bin/python"
      }
    }
  },

  // (Temporary) don't force a user; use the image default
  // "remoteUser": "user",

  // Quick sanity checks
  "postStartCommand": "echo 'Inside container:' && whoami && nvidia-smi && colmap -h >/dev/null 2>&1 || true"
}
// {
//   "name": "nerfstudio-colmap",
//   "build": { "dockerfile": "Dockerfile", "context": ".devcontainer" },
//   "workspaceMount": "source=${localWorkspaceFolder},target=/workspace,type=bind",
//   "workspaceFolder": "/workspace",
//   "runArgs": ["--gpus","all","--shm-size=12gb"],
//   "forwardPorts": [7007],
//   "remoteUser": "root", 
//   "postStartCommand": "echo 'Inside container:' && whoami && nvidia-smi || true"
// }